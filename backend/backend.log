INFO:     Will watch for changes in these directories: ['/Users/rezazeraat/Desktop/Pactoria-MVP/backend']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [8878] using WatchFiles
INFO:     Started server process [8881]
INFO:     Waiting for application startup.
2025-09-09 14:41:17,373 - app.main - INFO - Starting Pactoria MVP Backend...
2025-09-09 14:41:17,373 - app.core.database - INFO - Creating database tables...
2025-09-09 14:41:17,373 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-09-09 14:41:17,373 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-09 14:41:17,373 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("users")
2025-09-09 14:41:17,373 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-09 14:41:17,373 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,373 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("companies")
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("companies")
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("templates")
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("templates")
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("contracts")
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("contracts")
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("contract_versions")
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("contract_versions")
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("ai_generations")
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("ai_generations")
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("compliance_scores")
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("compliance_scores")
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("audit_logs")
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("audit_logs")
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("system_metrics")
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("system_metrics")
2025-09-09 14:41:17,376 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,376 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,377 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("notifications")
2025-09-09 14:41:17,377 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-09-09 14:41:17,377 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,377 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("integrations")
2025-09-09 14:41:17,377 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("integrations")
2025-09-09 14:41:17,377 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,377 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("integration_connections")
2025-09-09 14:41:17,377 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("integration_connections")
2025-09-09 14:41:17,377 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,377 INFO sqlalchemy.engine.Engine PRAGMA main.table_info("team_invitations")
2025-09-09 14:41:17,377 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("team_invitations")
2025-09-09 14:41:17,377 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-09 14:41:17,377 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-09 14:41:17,377 INFO sqlalchemy.engine.Engine COMMIT
2025-09-09 14:41:17,377 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-09 14:41:17,377 - app.core.database - INFO - ✅ Database tables created successfully
2025-09-09 14:41:17,377 - app.main - INFO - ✅ Database tables created
2025-09-09 14:41:17,377 - app.core.template_seeder - INFO - Starting template seeding...
2025-09-09 14:41:17,393 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-09-09 14:41:17,393 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-09 14:41:17,395 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT templates.id AS templates_id, templates.name AS templates_name, templates.category AS templates_category, templates.contract_type AS templates_contract_type, templates.description AS templates_description, templates.template_content AS templates_template_content, templates.compliance_features AS templates_compliance_features, templates.legal_notes AS templates_legal_notes, templates.version AS templates_version, templates.is_active AS templates_is_active, templates.suitable_for AS templates_suitable_for, templates.created_at AS templates_created_at, templates.updated_at AS templates_updated_at 
FROM templates) AS anon_1
2025-09-09 14:41:17,395 - sqlalchemy.engine.Engine - INFO - SELECT count(*) AS count_1 
FROM (SELECT templates.id AS templates_id, templates.name AS templates_name, templates.category AS templates_category, templates.contract_type AS templates_contract_type, templates.description AS templates_description, templates.template_content AS templates_template_content, templates.compliance_features AS templates_compliance_features, templates.legal_notes AS templates_legal_notes, templates.version AS templates_version, templates.is_active AS templates_is_active, templates.suitable_for AS templates_suitable_for, templates.created_at AS templates_created_at, templates.updated_at AS templates_updated_at 
FROM templates) AS anon_1
2025-09-09 14:41:17,395 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ()
2025-09-09 14:41:17,395 - sqlalchemy.engine.Engine - INFO - [generated in 0.00007s] ()
2025-09-09 14:41:17,395 - app.core.template_seeder - INFO - Templates already exist (6). Skipping seeding.
2025-09-09 14:41:17,395 INFO sqlalchemy.engine.Engine ROLLBACK
2025-09-09 14:41:17,395 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-09 14:41:17,395 - app.main - INFO - ✅ Templates seeded successfully
2025-09-09 14:41:17,395 - app.main - INFO - ✅ Pactoria MVP Backend started successfully
INFO:     Application startup complete.
2025-09-09 14:41:28,141 - app.main - INFO - GET /health - Status: 200 - Time: 0.0004s
INFO:     127.0.0.1:50304 - "GET /health HTTP/1.1" 200 OK
2025-09-09 14:42:23,651 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-09-09 14:42:23,651 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-09 14:42:23,652 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.email AS users_email, users.full_name AS users_full_name, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.is_admin AS users_is_admin, users.role AS users_role, users.department AS users_department, users.invitation_token AS users_invitation_token, users.invited_at AS users_invited_at, users.invited_by AS users_invited_by, users.company_id AS users_company_id, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.last_login_at AS users_last_login_at, users.timezone AS users_timezone, users.notification_preferences AS users_notification_preferences 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-09-09 14:42:23,652 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.full_name AS users_full_name, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.is_admin AS users_is_admin, users.role AS users_role, users.department AS users_department, users.invitation_token AS users_invitation_token, users.invited_at AS users_invited_at, users.invited_by AS users_invited_by, users.company_id AS users_company_id, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.last_login_at AS users_last_login_at, users.timezone AS users_timezone, users.notification_preferences AS users_notification_preferences 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-09-09 14:42:23,652 INFO sqlalchemy.engine.Engine [generated in 0.00013s] ('test@pactoria.com', 1, 0)
2025-09-09 14:42:23,652 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ('test@pactoria.com', 1, 0)
2025-09-09 14:42:23,654 INFO sqlalchemy.engine.Engine INSERT INTO companies (id, name, company_type, company_number, vat_number, industry, company_size, status, primary_contact_email, phone_number, website, address_line1, address_line2, city, county, postcode, country, subscription_tier, max_users, max_contracts_per_month, monthly_contract_count, is_verified, verified_at, is_vat_registered, compliance_requirements, created_by_user_id, last_activity_at, features_enabled, version, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at
2025-09-09 14:42:23,654 - sqlalchemy.engine.Engine - INFO - INSERT INTO companies (id, name, company_type, company_number, vat_number, industry, company_size, status, primary_contact_email, phone_number, website, address_line1, address_line2, city, county, postcode, country, subscription_tier, max_users, max_contracts_per_month, monthly_contract_count, is_verified, verified_at, is_vat_registered, compliance_requirements, created_by_user_id, last_activity_at, features_enabled, version, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at
2025-09-09 14:42:23,654 INFO sqlalchemy.engine.Engine [generated in 0.00019s] ('065d41a5-ab80-4d49-b929-9399abd2a03a', 'Test Company Ltd', None, None, None, None, 'SMALL', 'ACTIVE', None, None, None, None, None, None, None, None, 'United Kingdom', 'STARTER', 5, 50, 0, 0, None, 0, '[]', None, None, '["contract_generation", "team_management"]', 1, None)
2025-09-09 14:42:23,654 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] ('065d41a5-ab80-4d49-b929-9399abd2a03a', 'Test Company Ltd', None, None, None, None, 'SMALL', 'ACTIVE', None, None, None, None, None, None, None, None, 'United Kingdom', 'STARTER', 5, 50, 0, 0, None, 0, '[]', None, None, '["contract_generation", "team_management"]', 1, None)
2025-09-09 14:42:23,654 INFO sqlalchemy.engine.Engine ROLLBACK
2025-09-09 14:42:23,654 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-09 14:42:23,655 - app.main - ERROR - POST /api/v1/auth/register - Error: (sqlite3.IntegrityError) NOT NULL constraint failed: companies.company_type
[SQL: INSERT INTO companies (id, name, company_type, company_number, vat_number, industry, company_size, status, primary_contact_email, phone_number, website, address_line1, address_line2, city, county, postcode, country, subscription_tier, max_users, max_contracts_per_month, monthly_contract_count, is_verified, verified_at, is_vat_registered, compliance_requirements, created_by_user_id, last_activity_at, features_enabled, version, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at]
[parameters: ('065d41a5-ab80-4d49-b929-9399abd2a03a', 'Test Company Ltd', None, None, None, None, 'SMALL', 'ACTIVE', None, None, None, None, None, None, None, None, 'United Kingdom', 'STARTER', 5, 50, 0, 0, None, 0, '[]', None, None, '["contract_generation", "team_management"]', 1, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) - Time: 0.0107s
2025-09-09 14:42:23,655 - app.main - ERROR - Global exception handler caught: (sqlite3.IntegrityError) NOT NULL constraint failed: companies.company_type
[SQL: INSERT INTO companies (id, name, company_type, company_number, vat_number, industry, company_size, status, primary_contact_email, phone_number, website, address_line1, address_line2, city, county, postcode, country, subscription_tier, max_users, max_contracts_per_month, monthly_contract_count, is_verified, verified_at, is_vat_registered, compliance_requirements, created_by_user_id, last_activity_at, features_enabled, version, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at]
[parameters: ('065d41a5-ab80-4d49-b929-9399abd2a03a', 'Test Company Ltd', None, None, None, None, 'SMALL', 'ACTIVE', None, None, None, None, None, None, None, None, 'United Kingdom', 'STARTER', 5, 50, 0, 0, None, 0, '[]', None, None, '["contract_generation", "team_management"]', 1, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: companies.company_type

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/app/main.py", line 295, in add_process_time_header
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 163, in call_next
    raise app_exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/app/main.py", line 272, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 163, in call_next
    raise app_exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/app/api/v1/auth.py", line 95, in register_user
    db.flush()  # Get company ID without committing
    ~~~~~~~~^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: companies.company_type
[SQL: INSERT INTO companies (id, name, company_type, company_number, vat_number, industry, company_size, status, primary_contact_email, phone_number, website, address_line1, address_line2, city, county, postcode, country, subscription_tier, max_users, max_contracts_per_month, monthly_contract_count, is_verified, verified_at, is_vat_registered, compliance_requirements, created_by_user_id, last_activity_at, features_enabled, version, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at]
[parameters: ('065d41a5-ab80-4d49-b929-9399abd2a03a', 'Test Company Ltd', None, None, None, None, 'SMALL', 'ACTIVE', None, None, None, None, None, None, None, None, 'United Kingdom', 'STARTER', 5, 50, 0, 0, None, 0, '[]', None, None, '["contract_generation", "team_management"]', 1, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
INFO:     127.0.0.1:50308 - "POST /api/v1/auth/register HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: companies.company_type

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/app/main.py", line 295, in add_process_time_header
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 163, in call_next
    raise app_exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/app/main.py", line 272, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 163, in call_next
    raise app_exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/app/api/v1/auth.py", line 95, in register_user
    db.flush()  # Get company ID without committing
    ~~~~~~~~^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: companies.company_type
[SQL: INSERT INTO companies (id, name, company_type, company_number, vat_number, industry, company_size, status, primary_contact_email, phone_number, website, address_line1, address_line2, city, county, postcode, country, subscription_tier, max_users, max_contracts_per_month, monthly_contract_count, is_verified, verified_at, is_vat_registered, compliance_requirements, created_by_user_id, last_activity_at, features_enabled, version, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at]
[parameters: ('065d41a5-ab80-4d49-b929-9399abd2a03a', 'Test Company Ltd', None, None, None, None, 'SMALL', 'ACTIVE', None, None, None, None, None, None, None, None, 'United Kingdom', 'STARTER', 5, 50, 0, 0, None, 0, '[]', None, None, '["contract_generation", "team_management"]', 1, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-09-09 14:42:38,572 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-09-09 14:42:38,572 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-09 14:42:38,572 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.email AS users_email, users.full_name AS users_full_name, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.is_admin AS users_is_admin, users.role AS users_role, users.department AS users_department, users.invitation_token AS users_invitation_token, users.invited_at AS users_invited_at, users.invited_by AS users_invited_by, users.company_id AS users_company_id, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.last_login_at AS users_last_login_at, users.timezone AS users_timezone, users.notification_preferences AS users_notification_preferences 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-09-09 14:42:38,572 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.full_name AS users_full_name, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.is_admin AS users_is_admin, users.role AS users_role, users.department AS users_department, users.invitation_token AS users_invitation_token, users.invited_at AS users_invited_at, users.invited_by AS users_invited_by, users.company_id AS users_company_id, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.last_login_at AS users_last_login_at, users.timezone AS users_timezone, users.notification_preferences AS users_notification_preferences 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-09-09 14:42:38,572 INFO sqlalchemy.engine.Engine [cached since 14.92s ago] ('test@pactoria.com', 1, 0)
2025-09-09 14:42:38,572 - sqlalchemy.engine.Engine - INFO - [cached since 14.92s ago] ('test@pactoria.com', 1, 0)
2025-09-09 14:42:38,573 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, action, resource_type, resource_id, resource_name, user_id, user_name, user_role, details, ip_address, user_agent, location, risk_level, compliance_flag, additional_metadata, contract_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING timestamp
2025-09-09 14:42:38,573 - sqlalchemy.engine.Engine - INFO - INSERT INTO audit_logs (id, action, resource_type, resource_id, resource_name, user_id, user_name, user_role, details, ip_address, user_agent, location, risk_level, compliance_flag, additional_metadata, contract_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING timestamp
2025-09-09 14:42:38,573 INFO sqlalchemy.engine.Engine [generated in 0.00012s] ('f8ab0f2d-2373-488c-8847-9024cf5b854c', 'LOGIN', 'USER', None, 'test@pactoria.com', None, 'test@pactoria.com', None, 'User login failed: test@pactoria.com', '127.0.0.1', 'python-requests/2.32.5', None, 'HIGH', 1, '{}', None)
2025-09-09 14:42:38,573 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] ('f8ab0f2d-2373-488c-8847-9024cf5b854c', 'LOGIN', 'USER', None, 'test@pactoria.com', None, 'test@pactoria.com', None, 'User login failed: test@pactoria.com', '127.0.0.1', 'python-requests/2.32.5', None, 'HIGH', 1, '{}', None)
2025-09-09 14:42:38,575 INFO sqlalchemy.engine.Engine COMMIT
2025-09-09 14:42:38,575 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-09 14:42:38,575 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-09-09 14:42:38,575 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-09 14:42:38,576 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.action, audit_logs.resource_type, audit_logs.resource_id, audit_logs.resource_name, audit_logs.user_id, audit_logs.user_name, audit_logs.user_role, audit_logs.details, audit_logs.ip_address, audit_logs.user_agent, audit_logs.location, audit_logs.risk_level, audit_logs.compliance_flag, audit_logs.old_values, audit_logs.new_values, audit_logs.additional_metadata, audit_logs.timestamp, audit_logs.contract_id 
FROM audit_logs 
WHERE audit_logs.id = ?
2025-09-09 14:42:38,576 - sqlalchemy.engine.Engine - INFO - SELECT audit_logs.id, audit_logs.action, audit_logs.resource_type, audit_logs.resource_id, audit_logs.resource_name, audit_logs.user_id, audit_logs.user_name, audit_logs.user_role, audit_logs.details, audit_logs.ip_address, audit_logs.user_agent, audit_logs.location, audit_logs.risk_level, audit_logs.compliance_flag, audit_logs.old_values, audit_logs.new_values, audit_logs.additional_metadata, audit_logs.timestamp, audit_logs.contract_id 
FROM audit_logs 
WHERE audit_logs.id = ?
2025-09-09 14:42:38,576 INFO sqlalchemy.engine.Engine [generated in 0.00006s] ('f8ab0f2d-2373-488c-8847-9024cf5b854c',)
2025-09-09 14:42:38,576 - sqlalchemy.engine.Engine - INFO - [generated in 0.00006s] ('f8ab0f2d-2373-488c-8847-9024cf5b854c',)
2025-09-09 14:42:38,576 INFO sqlalchemy.engine.Engine ROLLBACK
2025-09-09 14:42:38,576 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-09 14:42:38,576 - app.main - WARNING - HTTP exception: 401 - Invalid email or password
2025-09-09 14:42:38,576 - app.main - INFO - POST /api/v1/auth/login - Status: 401 - Time: 0.0062s
INFO:     127.0.0.1:50312 - "POST /api/v1/auth/login HTTP/1.1" 401 Unauthorized
2025-09-09 14:42:38,578 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-09-09 14:42:38,578 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-09 14:42:38,578 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.email AS users_email, users.full_name AS users_full_name, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.is_admin AS users_is_admin, users.role AS users_role, users.department AS users_department, users.invitation_token AS users_invitation_token, users.invited_at AS users_invited_at, users.invited_by AS users_invited_by, users.company_id AS users_company_id, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.last_login_at AS users_last_login_at, users.timezone AS users_timezone, users.notification_preferences AS users_notification_preferences 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-09-09 14:42:38,578 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.email AS users_email, users.full_name AS users_full_name, users.hashed_password AS users_hashed_password, users.is_active AS users_is_active, users.is_admin AS users_is_admin, users.role AS users_role, users.department AS users_department, users.invitation_token AS users_invitation_token, users.invited_at AS users_invited_at, users.invited_by AS users_invited_by, users.company_id AS users_company_id, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.last_login_at AS users_last_login_at, users.timezone AS users_timezone, users.notification_preferences AS users_notification_preferences 
FROM users 
WHERE users.email = ?
 LIMIT ? OFFSET ?
2025-09-09 14:42:38,578 INFO sqlalchemy.engine.Engine [cached since 14.93s ago] ('test@pactoria.com', 1, 0)
2025-09-09 14:42:38,578 - sqlalchemy.engine.Engine - INFO - [cached since 14.93s ago] ('test@pactoria.com', 1, 0)
2025-09-09 14:42:38,579 INFO sqlalchemy.engine.Engine INSERT INTO companies (id, name, company_type, company_number, vat_number, industry, company_size, status, primary_contact_email, phone_number, website, address_line1, address_line2, city, county, postcode, country, subscription_tier, max_users, max_contracts_per_month, monthly_contract_count, is_verified, verified_at, is_vat_registered, compliance_requirements, created_by_user_id, last_activity_at, features_enabled, version, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at
2025-09-09 14:42:38,579 - sqlalchemy.engine.Engine - INFO - INSERT INTO companies (id, name, company_type, company_number, vat_number, industry, company_size, status, primary_contact_email, phone_number, website, address_line1, address_line2, city, county, postcode, country, subscription_tier, max_users, max_contracts_per_month, monthly_contract_count, is_verified, verified_at, is_vat_registered, compliance_requirements, created_by_user_id, last_activity_at, features_enabled, version, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at
2025-09-09 14:42:38,579 INFO sqlalchemy.engine.Engine [cached since 14.93s ago] ('b033324c-8f43-4a28-a4d7-5a86e727a8ab', 'Test Company Ltd', None, None, None, None, 'SMALL', 'ACTIVE', None, None, None, None, None, None, None, None, 'United Kingdom', 'STARTER', 5, 50, 0, 0, None, 0, '[]', None, None, '["contract_generation", "team_management"]', 1, None)
2025-09-09 14:42:38,579 - sqlalchemy.engine.Engine - INFO - [cached since 14.93s ago] ('b033324c-8f43-4a28-a4d7-5a86e727a8ab', 'Test Company Ltd', None, None, None, None, 'SMALL', 'ACTIVE', None, None, None, None, None, None, None, None, 'United Kingdom', 'STARTER', 5, 50, 0, 0, None, 0, '[]', None, None, '["contract_generation", "team_management"]', 1, None)
2025-09-09 14:42:38,579 INFO sqlalchemy.engine.Engine ROLLBACK
2025-09-09 14:42:38,579 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-09 14:42:38,579 - app.main - ERROR - POST /api/v1/auth/register - Error: (sqlite3.IntegrityError) NOT NULL constraint failed: companies.company_type
[SQL: INSERT INTO companies (id, name, company_type, company_number, vat_number, industry, company_size, status, primary_contact_email, phone_number, website, address_line1, address_line2, city, county, postcode, country, subscription_tier, max_users, max_contracts_per_month, monthly_contract_count, is_verified, verified_at, is_vat_registered, compliance_requirements, created_by_user_id, last_activity_at, features_enabled, version, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at]
[parameters: ('b033324c-8f43-4a28-a4d7-5a86e727a8ab', 'Test Company Ltd', None, None, None, None, 'SMALL', 'ACTIVE', None, None, None, None, None, None, None, None, 'United Kingdom', 'STARTER', 5, 50, 0, 0, None, 0, '[]', None, None, '["contract_generation", "team_management"]', 1, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) - Time: 0.0013s
2025-09-09 14:42:38,579 - app.main - ERROR - Global exception handler caught: (sqlite3.IntegrityError) NOT NULL constraint failed: companies.company_type
[SQL: INSERT INTO companies (id, name, company_type, company_number, vat_number, industry, company_size, status, primary_contact_email, phone_number, website, address_line1, address_line2, city, county, postcode, country, subscription_tier, max_users, max_contracts_per_month, monthly_contract_count, is_verified, verified_at, is_vat_registered, compliance_requirements, created_by_user_id, last_activity_at, features_enabled, version, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at]
[parameters: ('b033324c-8f43-4a28-a4d7-5a86e727a8ab', 'Test Company Ltd', None, None, None, None, 'SMALL', 'ACTIVE', None, None, None, None, None, None, None, None, 'United Kingdom', 'STARTER', 5, 50, 0, 0, None, 0, '[]', None, None, '["contract_generation", "team_management"]', 1, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: companies.company_type

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/app/main.py", line 295, in add_process_time_header
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 163, in call_next
    raise app_exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/app/main.py", line 272, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 163, in call_next
    raise app_exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/app/api/v1/auth.py", line 95, in register_user
    db.flush()  # Get company ID without committing
    ~~~~~~~~^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: companies.company_type
[SQL: INSERT INTO companies (id, name, company_type, company_number, vat_number, industry, company_size, status, primary_contact_email, phone_number, website, address_line1, address_line2, city, county, postcode, country, subscription_tier, max_users, max_contracts_per_month, monthly_contract_count, is_verified, verified_at, is_vat_registered, compliance_requirements, created_by_user_id, last_activity_at, features_enabled, version, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at]
[parameters: ('b033324c-8f43-4a28-a4d7-5a86e727a8ab', 'Test Company Ltd', None, None, None, None, 'SMALL', 'ACTIVE', None, None, None, None, None, None, None, None, 'United Kingdom', 'STARTER', 5, 50, 0, 0, None, 0, '[]', None, None, '["contract_generation", "team_management"]', 1, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
INFO:     127.0.0.1:50314 - "POST /api/v1/auth/register HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: companies.company_type

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        self.scope, self.receive, self.send
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/app/main.py", line 295, in add_process_time_header
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 163, in call_next
    raise app_exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 185, in __call__
    with collapse_excgroups():
         ~~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 187, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/app/main.py", line 272, in security_headers
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 163, in call_next
    raise app_exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/base.py", line 149, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 715, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 735, in app
    await route.handle(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/app/api/v1/auth.py", line 95, in register_user
    db.flush()  # Get company ID without committing
    ~~~~~~~~^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/rezazeraat/Desktop/Pactoria-MVP/backend/venv/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: companies.company_type
[SQL: INSERT INTO companies (id, name, company_type, company_number, vat_number, industry, company_size, status, primary_contact_email, phone_number, website, address_line1, address_line2, city, county, postcode, country, subscription_tier, max_users, max_contracts_per_month, monthly_contract_count, is_verified, verified_at, is_vat_registered, compliance_requirements, created_by_user_id, last_activity_at, features_enabled, version, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at]
[parameters: ('b033324c-8f43-4a28-a4d7-5a86e727a8ab', 'Test Company Ltd', None, None, None, None, 'SMALL', 'ACTIVE', None, None, None, None, None, None, None, None, 'United Kingdom', 'STARTER', 5, 50, 0, 0, None, 0, '[]', None, None, '["contract_generation", "team_management"]', 1, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-09-09 14:43:31,648 - app.main - INFO - GET / - Status: 200 - Time: 0.0008s
INFO:     127.0.0.1:50318 - "GET / HTTP/1.1" 200 OK
2025-09-09 14:43:31,803 - app.main - WARNING - HTTP exception: 404 - Not Found
2025-09-09 14:43:31,803 - app.main - INFO - GET /favicon.ico - Status: 404 - Time: 0.0016s
INFO:     127.0.0.1:50318 - "GET /favicon.ico HTTP/1.1" 404 Not Found
WARNING:  WatchFiles detected changes in 'app/core/auth.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-09-09 15:39:24,666 - app.main - INFO - Shutting down Pactoria MVP Backend...
INFO:     Application shutdown complete.
INFO:     Finished server process [8881]
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/core/database.py', 'app/core/config.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/core/template_seeder.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/schemas/bulk.py', 'app/schemas/auth.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/api/v1/auth.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/api/v1/audit.py', 'app/api/v1/files.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/api/v1/ai.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/api/v1/security.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/api/v1/team.py', 'app/api/v1/templates.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/api/v1/notifications.py', 'app/api/v1/contracts.py', 'app/api/v1/search.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/api/v1/analytics.py', 'app/api/v1/integrations.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/application/services/notification_service.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/application/services/enhanced_notification_service.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/main.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/infrastructure/repositories/sqlalchemy_notification_repository.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/infrastructure/external_services/ai_service.py', 'app/infrastructure/repositories/in_memory_integration_repository.py', 'app/infrastructure/repositories/sqlalchemy_contract_repository.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/infrastructure/external_services/companies_house_service.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/domain/repositories/integration.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/domain/repositories/notification_repository.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/domain/services/email_notification_service.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/domain/services/ai_risk_assessment_service.py', 'app/domain/services/integration_service.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/domain/entities/clause_library.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/domain/entities/notification.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/domain/entities/integration.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/services/ai_service.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/services/audit_service.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
WARNING:  WatchFiles detected changes in 'app/services/search_service.py', 'app/services/bulk_operations_service.py'. Reloading...
Fatal Python error: init_sys_streams: can't initialize sys standard streams
Python runtime state: core initialized
OSError: [Errno 9] Bad file descriptor

Current thread 0x0000000205b8e0c0 (most recent call first):
  <no Python frame>
